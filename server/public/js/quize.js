var questions = [
    {
        num: 1,
        Marks: 2,
        question: "Who was the founder of the Rajput dynasty?",
        answer: "Raja Ajaypal",
        options: [
            "Raja Prithviraj Chauhan",
            "Raja Ajaypal",
            "Raja Rana Kumbha",
            "Raja Man Singh"
        ]
    },
    {
        num: 2,
        Marks: 2,
        question: "Which ruler of Rajasthan built the Chittorgarh Fort?",
        answer: "Bappa Rawal",
        options: [
            "Maharana Pratap",
            "Rana Sanga",
            "Bappa Rawal",
            "Rana Kumbha"
        ]
    },
    {
        num: 3,
        Marks:4,
        question: "Who was the first ruler of the Mewar Kingdom?",
        answer: "Bapa Rawal",
        options: [
            "Maharana Udai Singh",
            "Rana Sanga",
            "Rana Kumbha",
            "Bapa Rawal"
        ]
    },
    {
        num: 4,
        Marks: 3,
        question: "Who founded the city of Jaipur?",
        answer: "Maharaja Sawai Jai Singh II",
        options: [
            "Maharaja Man Singh II",
            "Maharaja Sawai Jai Singh II",
            "Maharaja Ajit Singh",
            "Maharaja Prithviraj Singh"
        ]
    },
    {
        num: 5,
        Marks: 3,
        question: "Which Rajasthani ruler was known as the 'Hindu Maratha'?",
        answer: "Maharaja Ajit Singh",
        options: [
            "Maharaja Prithviraj Singh",
            "Maharaja Man Singh II",
            "Maharaja Ajit Singh",
            "Maharaja Sawai Jai Singh II"
        ]
    },
    {
        num: 6,
        Marks: 5,
        question: "Who was the first female ruler of Rajasthan?",
        answer: "Rani Padmini",
        options: [
            "Rani Karnavati",
            "Rani Padmini",
            "Rani Meera Bai",
            "Rani Durgavati"
        ]
    },
    {
        num: 7,
        Marks: 5,
        question: "Which Rajasthani ruler was known as the 'Veera Bhoomi Chakravarthy'?",
        answer: "Maharana Pratap",
        options: [
            "Maharana Pratap",
            "Maharaja Ajit Singh",
            "Maharaja Sawai Jai Singh II",
            "Maharaja Man Singh II"
        ]
    },
    {
        num: 8,
        Marks: 1,
        question: "Who built the famous 'Junagarh Fort' in Bikaner?",
        answer: "Raja Rai Singh",
        options: [
            "Raja Man Singh",
            "Raja Rana Kumbha",
            "Raja Rai Singh",
            "Raja Ratan Singh"
        ]
    },
    {
        num: 9,
        Marks: 3,
        question: "Which Rajasthani ruler was known as the 'Mewar Lion'?",
        answer: "Maharana Pratap",
        options: [
            "Maharaja Ajit Singh",
            "Maharana Pratap",
            "Maharaja Sawai Jai Singh II",
            "Maharaja Man Singh II"
        ]
    },
    {
        num: 10,
        Marks: 1,
        question: "Which Rajasthani ruler built the famous 'Jaisalmer Fort'?",
        answer: "Raja Jaisal",
        options: [
            "Raja Jaisal",
            "Raja Rai Singh",
            "Raja Ratan Singh",
            "Raja Rana Kumbha"
        ]
    },
    // {
    //     num: 11,
    //     question: "Who was the founder of the Jodhpur kingdom?",
    //     answer: "Rao Jodha",
    //     options: [
    //         "Rao Jodha",
    //         "Raja Ajit Singh",
    //         "Maharaja Sawai Jai Singh II",
    //         "Maharaja Man Singh II"
    //     ]
    // },
    // {
    //     num: 12,
    //     question: "Which Rajasthani ruler was known as the 'Patriot King'?",
    //     answer: "Maharaja Ajit Singh",
    //     options: [
    //         "Maharaja Ajit Singh",
    //         "Maharana Pratap",
    //         "Maharaja Sawai Jai Singh II",
    //         "Maharaja Man Singh II"
    //     ]
    // },
    // {
    //     num: 13,
    //     question: "Who was the first Indian ruler to establish a treaty with the British?",
    //     answer: "Raja Ajit Singh",
    //     options: [
    //         "Raja Ajit Singh",
    //         "Maharana Pratap",
    //         "Maharaja Sawai Jai Singh II",
    //         "Maharaja Man Singh II"
    //     ]
    // },
    // {
    //     num: 14,
    //     question: "Who was the founder of the Kota kingdom?",
    //     answer: "Rao Deva",
    //     options: [
    //         "Rao Deva",
    //         "Rao Jodha",
    //         "Maharaja Sawai Jai Singh II",
    //         "Maharaja Man Singh II"
    //     ]
    // },
    // {
    //     num: 15,
    //     question: "Which Rajasthani ruler was known as the 'Grand Old Man of India'?",
    //     answer: "Maharaja Ajit Singh",
    //     options: [
    //         "Maharaja Ajit Singh",
    //         "Maharana Pratap",
    //         "Rao Jodha",
    //         "Raja Rai Singh"
    //     ]
    // },
    // {
    //     num: 16,
    //     question: "Who wrote the Ramayana?",
    //     answer: "Valmiki",
    //     options: [
    //         "Tulsidas",
    //         "Valmiki",
    //         "Ved Vyas",
    //         "Kalidasa"
    //     ]
    // },
    // {
    //     num: 17,
    //     question: "What is the name of Lord Rama's father?",
    //     answer: "King Dasharatha",
    //     options: [
    //         "King Janaka",
    //         "King Dasharatha",
    //         "King Sugriva",
    //         "King Angad"
    //     ]
    // },
    // {
    //     num: 18,
    //     question: "What is the name of Lord Rama's wife?",
    //     answer: "Sita",
    //     options: [
    //         "Sita",
    //         "Draupadi",
    //         "Urmila",
    //         "Mandodari"
    //     ]
    // },
    // {
    //     num: 19,
    //     question: "Who was the king of Lanka in the Ramayana?",
    //     answer: "Ravana",
    //     options: [
    //         "Ravana",
    //         "Kumbhakarna",
    //         "Vibhishana",
    //         "Mandodari"
    //     ]
    // },
    // {
    //     num: 20,
    //     question: "What is the name of Lord Rama's devoted follower and companion?",
    //     answer: "Hanuman",
    //     options: [
    //         "Hanuman",
    //         "Arjuna",
    //         "Bheema",
    //         "Lakshmana"
    //     ]
    // },
    // {
    //     num: 21,
    //     question: "Who was the father of Bhishma Pitamah?",
    //     answer: "King Shantanu",
    //     options: [
    //         "King Pandu",
    //         "King Dhritarashtra",
    //         "King Shantanu",
    //         "King Dushyanta"
    //     ]
    // },
    // {
    //     num: 22,
    //     question: "What was the name of Arjuna's bow in the Mahabharata?",
    //     answer: "Gandiva",
    //     options: [
    //         "Vijaya",
    //         "Sharanga",
    //         "Gandiva",
    //         "Pashupatastra"
    //     ]
    // },
    // {
    //     num: 23,
    //     question: "Who was the charioteer of Arjuna during the Kurukshetra war?",
    //     answer: "Lord Krishna",
    //     options: [
    //         "Bhishma Pitamah",
    //         "Dronacharya",
    //         "Lord Krishna",
    //         "Karna"
    //     ]
    // }
];

// ---------------------------------------------------------------------------------------------

const start_quiz = document.querySelector(".start-quiz");
const quiz_box = document.querySelector(".quiz-box");
const que_text = document.querySelector(".que_text");
const options_box = document.querySelector(".options");
const next_btn = document.querySelector(".next-btn");
const total_q = document.querySelector(".quiz-footer .total_que");
const count_q = document.querySelector(".quiz-footer .count_que");
const result_box = document.querySelector(".result-box");
const total_que_r = document.querySelector(".total-que span");
const right_ans_r = document.querySelector(".right-ans span");
const Obtained_marks = document.querySelector(".Obtained_marks span");
const wrong_ans_r = document.querySelector(".wrong-ans span");
const percentage = document.querySelector(".percentage span");

const mark_wrong = `<i class="fa fa-times"></i>`;
const mark_check = `<i class="fa fa-check"></i>`;

const btns_start = document.querySelector(".btns-start");
const warning_box = document.querySelector(".warning-box");
const btns_cancle = document.querySelector(".btns-cancle");
const Q_Marks = document.querySelector(".Q_Marks");
const cal_total_marks = document.querySelector(".cal-total-marks");
const Attempt = document.querySelector(".Attempt span");
const avoided = document.querySelector(".avoided span");
const Right_answers = document.querySelector(".Right-answers span");

start_quiz.onclick=()=>{
    warning_box.classList.remove("inactive");
    start_quiz.classList.add("inactive");
}
btns_cancle.onclick=()=>{
    warning_box.classList.add("inactive");
    start_quiz.classList.remove("inactive");
    document.getElementById('totalTimeInput').value='';
}
btns_start.onclick = () => {
    if(document.getElementById('totalTimeInput').value!=''){
      quiz_box.classList.remove("inactive");
      btns_start.classList.add("inactive");
      warning_box.classList.add("inactive");
      setTime();
      timeStart();  
    }
    else{
        document.getElementById('customAlert').style.display = "block"; // Show custom alert
    }
}
function closeAlert() {
    document.getElementById('customAlert').style.display = "none"; // Hide custom alert
}

total_q.innerText = questions.length;
total_que_r.innerText = questions.length;

var que_index=0;
var que_index_marks=0;
var marks_obtained = 0;
var right_answer = 0;
var total_Marks = 0;
while (que_index_marks < questions.length) {
    total_Marks += questions[que_index_marks].Marks;
    que_index_marks++;
}
var wrong_answers = 0;
function showQuestion(q_index){
    que_text.innerText = questions[q_index].num+". "+ questions[q_index].question;
    Q_Marks.innerText = questions[q_index].Marks;
    var option_statement = "";
    for(var i=0;i<questions[q_index].options.length;i++){
        option_statement += `<div class="option">${questions[q_index].options[i]}</div>`;
    }
    options_box.innerHTML = option_statement;
    var Alloptions = options_box.querySelectorAll(".option");
    for(var j=0; j<Alloptions.length; j++){
        Alloptions[j].setAttribute("onclick","UserAnswer(this)");
        Alloptions[j].addEventListener("click", function(e) {
            e.preventDefault();
            UserAnswer_Database(this);
        });
     }
     next_btn.classList.add("inactive");
}
showQuestion(que_index);

next_btn.onclick=()=>{
    que_index++;
    if(questions.length>que_index){
        count_q.innerText = que_index+1;
        showQuestion(que_index);
    }
    else{
        console.log("Question Complete");
        result_box.classList.remove("inactive");
        quiz_box.classList.add("inactive");
        right_ans_r.innerText = total_Marks;
        Obtained_marks.innerText = marks_obtained;
        Attempt.innerText = right_answer+wrong_answers;
        avoided.innerText = questions.length - (right_answer+wrong_answers);
        wrong_ans_r.innerText = wrong_answers;
        Right_answers.innerText = right_answer;
        percentage.innerText = ((marks_obtained*100)/total_Marks).toFixed(2)+"%";

    }
    if(questions.length-1==que_index){
        next_btn.innerText="Finish";
    }
}
function UserAnswer(e){
    let userAns = e.innerText;
    let correctAns = questions[que_index].answer;
    var Alloptions2 = options_box.querySelectorAll(".option");
    
    next_btn.classList.remove("inactive");
    if(userAns==correctAns){
        console.log("right");
        e.classList.add("correct");
        e.insertAdjacentHTML("beforeend",mark_check)
        marks_obtained = marks_obtained + questions[que_index].Marks;
        cal_total_marks.innerText = marks_obtained;
        right_answer++;
    }
    else{
        console.log("wrong");
        e.classList.add("incorrect");
        e.insertAdjacentHTML("beforeend",mark_wrong)
        wrong_answers++;

        for(i=0; i<Alloptions2.length; i++){
            if(Alloptions2[i].innerText==correctAns){
                Alloptions2[i].classList.add("correct");
                Alloptions2[i].insertAdjacentHTML("beforeend",mark_check)
            }
        }
    }
    for(var j=0; j<Alloptions2.length; j++){
        Alloptions2[j].classList.add("disabled");
     }
}

function reset(){
    que_index=0;
    marks_obtained=0;
    right_answer=0;
    wrong_answers=0;
    cal_total_marks.innerText=0;
    count_q.innerText=que_index+1;
    showQuestion(que_index);
    next_btn.innerText="Next Question";
}

let totalSeconds;

function setTime() {
    const totalTimeInput = document.getElementById('totalTimeInput').value;
    totalSeconds = parseInt(totalTimeInput) *60;
    
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
    document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
}
let timerInterval;
function timeStart(){
    timerInterval = setInterval(() => {
        if (totalSeconds === 0) {
            clearInterval(timerInterval);
            alert('Timer expired!');
            //   -----end the quize -- from next_btn => else, questions.length<=que_index
            result_box.classList.remove("inactive");
            quiz_box.classList.add("inactive");
            right_ans_r.innerText = total_Marks;
            Obtained_marks.innerText = marks_obtained;
            wrong_ans_r.innerText = wrong_answers;
            Right_answers.innerText = right_answer;
            Attempt.innerText = right_answer+wrong_answers;
            avoided.innerText = questions.length - (right_answer+wrong_answers);
            percentage.innerText = ((marks_obtained*100)/total_Marks).toFixed(2)+"%";
           //   -----end the quize -- 
        } else {
            totalSeconds--;
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
        }
    }, 1000);
};

const again_quiz = document.querySelector(".result-footer .again-quiz");
const exit = document.querySelector(".result-footer .exit");


again_quiz.onclick=()=>{
    result_box.classList.add("inactive");
    quiz_box.classList.remove("inactive");
    reset();
    setTime();
    clearInterval(timerInterval);
    timeStart();
}
exit.onclick=()=>{
    result_box.classList.add("inactive");
    start_quiz.classList.remove("inactive");
    btns_start.classList.remove("inactive");
    reset();
    document.getElementById('totalTimeInput').value='';
}

// ----- for database --

function UserAnswer_Database(e) {
    let user_answer = e.innerText;
    let Total_Question_in_Quiz = questions.length;
    let Quiz_Total_Marks = total_Marks;
    let Question = questions[que_index].question;
    let correct_Ans = questions[que_index].answer;
    let questionMarks = questions[que_index].Marks;
    let questionnum = questions[que_index].num;
    let sender_id = document.getElementById("userEmail").getAttribute("data-email");

    // Make a POST request to your backend endpoint to store the user's answer
    fetch('/store-answer-Question', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            sender_id,
            Total_Question_in_Quiz,
            Quiz_Total_Marks,
            Question,
            user_answer,
            correct_Ans,
            questionMarks,
            questionnum
        })
    })
    .then(response => {
        if (response.ok) {
            console.log('Answer stored successfully');
        } else {
            console.error('Failed to store answer');
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });

}
